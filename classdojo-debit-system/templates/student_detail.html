{% extends "base.html" %}

{% block title %}{{ student[2] }} {{ student[3] }} - ClassDojo Debit System{% endblock %}

{% block content %}
<h1>👤 Student Details</h1>

<div class="card">
    <h2>{{ student[2] }} {{ student[3] }}</h2>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
        <div>
            <strong>Student ID:</strong><br>
            {{ student[1] }}
        </div>
        <div>
            <strong>Class:</strong><br>
            {{ student[4] if student[4] else 'N/A' }}
        </div>
        <div>
            <strong>Card ID:</strong><br>
            {{ student[5] if student[5] else 'No card assigned' }}
        </div>
        <div>
            <strong>Current Balance:</strong><br>
            <span style="font-size: 1.5em; font-weight: bold; color: #667eea;">
                {{ student[6] }} points
            </span>
        </div>
    </div>
    
    <div style="margin-top: 30px;">
        <a href="{{ url_for('students') }}" class="btn btn-secondary">← Back to Students</a>
        {% if not student[5] %}
            <a href="{{ url_for('assign_card') }}" class="btn">Assign Card</a>
        {% endif %}
    </div>
</div>

<div class="card">
    <h2>📜 Transaction History</h2>
    
    {% if transactions %}
        <table>
            <thead>
                <tr>
                    <th>Date/Time</th>
                    <th>Type</th>
                    <th>Amount</th>
                    <th>Description</th>
                    <th>Location</th>
                    <th>Balance After</th>
                </tr>
            </thead>
            <tbody>
                {% for transaction in transactions %}
                <tr>
                    <td>{{ transaction[7] }}</td>
                    <td>
                        <span style="padding: 5px 10px; border-radius: 5px; font-size: 0.9em; 
                                     background: {% if transaction[2] == 'purchase' %}#f8d7da{% else %}#d4edda{% endif %}; 
                                     color: {% if transaction[2] == 'purchase' %}#721c24{% else %}#155724{% endif %};">
                            {{ transaction[2]|upper }}
                        </span>
                    </td>
                    <td style="font-weight: bold; color: {% if transaction[3] > 0 %}#28a745{% else %}#dc3545{% endif %};">
                        {{ transaction[3] }} points
                    </td>
                    <td>{{ transaction[4] if transaction[4] else '-' }}</td>
                    <td>{{ transaction[6] if transaction[6] else '-' }}</td>
                    <td>{{ transaction[5] }} points</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p style="text-align: center; padding: 40px; color: #6c757d;">
            No transactions yet.
        </p>
    {% endif %}
</div>
{% endblock %}
